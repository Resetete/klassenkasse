<!doctype html>
<html lang="en" data-theme="minimal">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="canonical" href="https://www.classfund.app/" />
  <title>Class Fund — Family Accounts</title>
  <meta name="description" content="Free class fund app (Klassenkasse). GDPR/DSGVO compliant, no login, no cloud. Data is stored locally in your browser. Export regular backups to avoid data loss." />

  <link rel="stylesheet" href="style.css" />

  <!-- Favicons -->
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">
</head>

<body>
  <div class="app">

    <!-- =====================================================
         HEADER
         ===================================================== -->
    <header class="topbar">
      <div class="topbar__title">
        <h1 data-i18n="appTitle">Class Fund</h1>
        <p class="sub" data-i18n="appSubtitle">
          Family accounts, contributions, split class expenses, balances & email texts.
        </p>
      </div>

      <div class="topbar__controls">
        <div class="seg">
          <label class="seg__label" for="lang" data-i18n="languageLabel">Language</label>
          <select id="lang" class="seg__select">
            <option value="en">EN</option>
            <option value="de">DE</option>
          </select>
        </div>

        <div class="seg">
          <label class="seg__label" for="theme" data-i18n="themeLabel">Theme</label>
          <select id="theme" class="seg__select">
            <option value="minimal">Minimal</option>
            <option value="paper">Paper</option>
          </select>
        </div>

        <button class="btn" id="reminderBtn" type="button" data-i18n="reminderBtn">Reminders</button>
        <button class="btn" id="exportBtn" type="button" data-i18n="exportBtn">Export</button>

        <label class="btn btn--file">
          <input id="importInput" type="file" accept="application/json" />
          <span data-i18n="importBtn">Import</span>
        </label>

        <button class="btn btn--danger" id="resetBtn" type="button" data-i18n="resetBtn">Reset</button>
      </div>

      <!-- Donate -->
      <div class="donateButton">
        <form action="https://www.paypal.com/donate" method="post" target="_top" class="donate">
          <input type="hidden" name="hosted_button_id" value="UA2Y443NFH76J" />
          <input
            type="image"
            src="https://pics.paypal.com/00/s/NTE0YTZlOWQtZGUwNy00NzU3LWI4ZDYtNWQ2NmYwMTA4YWE2/file.PNG"
            name="submit"
            alt="Donate with PayPal"
          />
        </form>
      </div>
    </header>

    <!-- =====================================================
    MAIN GRID
    ===================================================== -->
    <main class="grid">

      <!-- ================= LEFT COLUMN ================= -->
      <section class="card">

        <!-- Summary -->
        <h2 data-i18n="summaryTitle">Overview</h2>
        <div class="summary">
          <div class="summary__item">
            <div class="summary__label" data-i18n="totalBalanceLabel">Total balance</div>
            <div class="summary__value" id="totalBalance">0,00 €</div>
          </div>
          <div class="summary__item">
            <div class="summary__label" data-i18n="familiesCountLabel">Families</div>
            <div class="summary__value" id="familiesCount">0</div>
          </div>
          <div class="summary__item">
            <div class="summary__label" data-i18n="txCountLabel">Transactions</div>
            <div class="summary__value" id="txCount">0</div>
          </div>
        </div>

        <hr class="hr" />

        <!-- Settings -->
        <h2 data-i18n="settingsTitle">Settings</h2>
        <div class="field">
          <label for="targetAmount" data-i18n="targetAmountLabel">Target amount per family (€)</label>
          <input id="targetAmount" type="number" min="0" step="0.01" inputmode="decimal" data-i18n-placeholder="phTargetAmount" />
        </div>
        <p class="hint" data-i18n="targetHint">
          If set: each family should have at least this balance.
        </p>

        <hr class="hr" />

        <!-- ================= DEPOSIT ================= -->
        <h2 data-i18n="depositTitle">Contribution</h2>

        <div class="field">
          <label for="depositDate" data-i18n="dateLabel">Date</label>
          <input id="depositDate" type="date" />
        </div>

        <div class="field">
          <label for="depositFamily" data-i18n="familyLabel">Family</label>
          <select id="depositFamily"></select>
        </div>

        <div class="field">
          <label for="depositAmount" data-i18n="amountLabel">Amount (€)</label>
          <input id="depositAmount" type="number" step="0.01" inputmode="decimal" data-i18n-placeholder="phDepositAmount" />
        </div>

        <div class="field">
          <label for="depositNote" data-i18n="noteLabel">Note (optional)</label>
          <input id="depositNote" type="text" maxlength="120" data-i18n-placeholder="phDepositNote" />
        </div>

        <button class="btn btn--primary" id="addDepositBtn" type="button" data-i18n="addDepositBtn">
          Add contribution
        </button>

        <hr class="hr" />

        <!-- ================= EXPENSE ================= -->
        <h2 data-i18n="classExpenseTitle">Split class expense</h2>

        <div class="field">
          <label for="expenseDate" data-i18n="dateLabel">Date</label>
          <input id="expenseDate" type="date" />
        </div>

        <div class="field">
          <label for="expenseTitle" data-i18n="expenseTitleLabel">Title</label>
          <input id="expenseTitle" type="text" maxlength="80" data-i18n-placeholder="phExpenseTitle" />
        </div>

        <div class="field">
          <label for="expenseAmount" data-i18n="totalAmountLabel">Total amount (€)</label>
          <input id="expenseAmount" type="number" step="0.01" inputmode="decimal" data-i18n-placeholder="phExpenseAmount" />
        </div>

        <div class="field">
          <label>Auswahl</label>
          <div class="radio">
            <label style="display:flex; gap:8px; align-items:center;">
              <input type="radio" name="expenseMode" id="expenseModeAll" />
              <span>Alle Familien auswählen</span>
            </label>
            <label style="display:flex; gap:8px; align-items:center; margin-left:14px;">
              <input type="radio" name="expenseMode" id="expenseModeCustom" />
              <span>Nur ausgewählte Familien</span>
            </label>
          </div>
        </div>

        <div class="field">
          <label data-i18n="expenseSelectLabel">Families</label>
          <div id="expenseFamilyChecklist" class="checklist"></div>
          <p class="hint" id="expenseAllHint" hidden data-i18n="expenseAllHint">
            All eligible families are preselected — uncheck to exclude.
          </p>
        </div>

        <button class="btn btn--primary" id="addExpenseBtn" type="button" data-i18n="addExpenseBtn">
          Split expense
        </button>

        <p class="hint" data-i18n="roundingHint">
          Cent remainders are distributed fairly.
        </p>

        <hr class="hr" />

        <!-- ================= ADD FAMILY ================= -->
        <details id="familyFormDetails" class="detailsCard">
          <summary class="detailsSummary">
            <span data-i18n="addFamilyTitle">Add family</span>
            <span class="muted small" data-i18n="familyRareHint">(rarely needed – new family joins)</span>
          </summary>

          <div class="detailsBody">
            <div class="field">
              <label for="parent1" data-i18n="parent1Label">Parent 1</label>
              <input id="parent1" type="text" maxlength="60" data-i18n-placeholder="phParent1" />
            </div>

            <div class="field">
              <label for="parent2" data-i18n="parent2Label">Parent 2 (optional)</label>
              <input id="parent2" type="text" maxlength="60" data-i18n-placeholder="phParent2" />
            </div>

            <div class="field">
              <label for="email" data-i18n="emailLabel">Email</label>
              <input id="email" type="email" maxlength="120" data-i18n-placeholder="phEmail" />
              <p class="hint" data-i18n="emailOptionalHint">Optional — reminders/emails are disabled without an email.</p>
            </div>

            <div class="field">
              <label for="children" data-i18n="childrenLabel">Children (comma-separated)</label>
              <input id="children" type="text" maxlength="120" data-i18n-placeholder="phChildren" />
            </div>

            <div class="row2">
              <div class="field">
                <label for="activeFrom" data-i18n="activeFromLabel">In class from</label>
                <input id="activeFrom" type="date" />
              </div>
              <div class="field">
                <label for="activeTo" data-i18n="activeToLabel">In class until</label>
                <input id="activeTo" type="date" />
              </div>
            </div>

            <div class="field">
              <label for="familyNote" data-i18n="familyNoteLabel">Comment</label>
              <input id="familyNote" type="text" maxlength="160" data-i18n-placeholder="phFamilyNote" />
            </div>

            <button class="btn btn--primary" id="addFamilyBtn" type="button" data-i18n="addFamilyBtn">
              Add family
            </button>

            <p class="hint" data-i18n="familyHint">
              Tip: inactive families are excluded from selections, but remain in history.
            </p>
          </div>
        </details>
      </section>

      <!-- ================= RIGHT COLUMN ================= -->
      <section class="card">
        <h2 data-i18n="familiesTitle">Families</h2>
        <div id="familiesList" class="families"></div>

        <hr class="hr" />

        <h2 data-i18n="ledgerTitle">History</h2>
        <div id="ledger" class="ledger"></div>

        <p class="empty muted" id="emptyState" hidden data-i18n="emptyState">
          No transactions yet.
        </p>
      </section>
    </main>

    <!-- ================= MODALS (kept for full features) ================= -->

    <!-- Export modal -->
    <dialog id="exportDialog" class="dialog">
      <div class="dialog__head">
        <strong data-i18n="exportTitle">Export</strong>
        <button class="btn btn--icon" id="closeExport" type="button" aria-label="Close">✕</button>
      </div>
      <p class="muted" data-i18n="exportHelp">Copy this JSON or download it as a file.</p>
      <textarea id="exportText" class="exportText" rows="10" readonly></textarea>
      <div class="dialog__actions">
        <button class="btn" id="copyExport" type="button" data-i18n="copyBtn">Copy</button>
        <button class="btn btn--primary" id="downloadExport" type="button" data-i18n="downloadBtn">Download .json</button>
      </div>
    </dialog>

    <!-- Reset confirm -->
    <dialog id="confirmDialog" class="dialog">
      <div class="dialog__head">
        <strong data-i18n="resetTitle">Reset everything?</strong>
        <button class="btn btn--icon" id="closeConfirm" type="button" aria-label="Close">✕</button>
      </div>
      <p class="muted" data-i18n="resetHelp">All data will be removed from this browser. Export first if you want a backup.</p>
      <div class="dialog__actions">
        <button class="btn" id="cancelReset" type="button" data-i18n="cancelBtn">Cancel</button>
        <button class="btn btn--danger" id="confirmReset" type="button" data-i18n="confirmBtn">Reset</button>
      </div>
    </dialog>

    <!-- Email modal -->
    <dialog id="emailDialog" class="dialog dialog--wide">
      <div class="dialog__head">
        <strong data-i18n="emailTitle">Create email</strong>
        <button class="btn btn--icon" id="closeEmail" type="button" aria-label="Close">✕</button>
      </div>

      <div class="emailGrid">
        <div class="emailCol">
          <div class="field">
            <label for="emailSubject" data-i18n="emailSubjectLabel">Subject</label>
            <input id="emailSubject" type="text" maxlength="120" />
          </div>

          <div class="field">
            <label for="emailTemplate" data-i18n="emailTemplateLabel">Template</label>
            <textarea id="emailTemplate" rows="10"></textarea>
          </div>

          <p class="hint" data-i18n="emailPlaceholdersHint">
            Placeholders: {{parents}}, {{children}}, {{balance}}, {{due}}, {{target}}, {{email}}, {{today}}
          </p>

          <div class="dialog__actions">
            <button class="btn" id="copyEmail" type="button" data-i18n="copyBtn">Copy</button>
            <button class="btn btn--primary" id="openMailto" type="button" data-i18n="openMailBtn">Open mail app</button>
          </div>
        </div>

        <div class="emailCol">
          <div class="field">
            <label data-i18n="emailPreviewLabel">Preview</label>
            <pre id="emailPreview" class="preview"></pre>
          </div>
        </div>
      </div>
    </dialog>

    <!-- Reminder batch modal -->
    <dialog id="reminderDialog" class="dialog dialog--wide">
      <div class="dialog__head">
        <strong data-i18n="reminderTitle">Reminder batch</strong>
        <button class="btn btn--icon" id="closeReminder" type="button" aria-label="Close">✕</button>
      </div>

      <div class="reminderTop">
        <div class="seg">
          <label class="seg__label" for="reminderMode" data-i18n="reminderModeLabel">Criteria</label>
          <select id="reminderMode" class="seg__select">
            <option value="below_target" data-i18n="reminderBelowTarget">Below target</option>
            <option value="negative_only" data-i18n="reminderNegativeOnly">Negative only</option>
          </select>
        </div>

        <label class="toggle">
          <input id="reminderActiveOnly" type="checkbox" checked />
          <span data-i18n="reminderActiveOnly">Active families only</span>
        </label>
      </div>

      <div class="emailGrid">
        <div class="emailCol">
          <div class="field">
            <label for="reminderSubject" data-i18n="emailSubjectLabel">Subject</label>
            <input id="reminderSubject" type="text" maxlength="120" />
          </div>

          <div class="field">
            <label for="reminderTemplate" data-i18n="emailTemplateLabel">Template</label>
            <textarea id="reminderTemplate" rows="10"></textarea>
          </div>

          <p class="hint" data-i18n="reminderHint">
            Placeholders: {{parents}}, {{children}}, {{balance}}, {{due}}, {{target}}, {{email}}, {{today}}
          </p>

          <div class="dialog__actions">
            <button class="btn" id="copyAllReminders" type="button" data-i18n="copyAllBtn">Copy all</button>
            <button class="btn btn--primary" id="openNextReminder" type="button" data-i18n="openNextBtn">Open next email</button>
          </div>

          <div class="muted small" id="reminderCount"></div>
        </div>

        <div class="emailCol">
          <div class="field">
            <label data-i18n="reminderListLabel">Recipients</label>
            <div id="reminderList" class="reminderList"></div>
          </div>
        </div>
      </div>
    </dialog>

    <!-- Family report modal -->
    <dialog id="reportDialog" class="dialog dialog--wide">
      <div class="dialog__head">
        <strong data-i18n="reportTitle">Overview</strong>
        <button class="btn btn--icon" id="closeReport" type="button" aria-label="Close">✕</button>
      </div>

      <div id="reportContent" class="report"></div>

      <div class="dialog__actions">
        <button class="btn" id="copyReport" type="button" data-i18n="copyBtn">Copy</button>
        <button class="btn btn--primary" id="printReport" type="button" data-i18n="printBtn">Print / PDF</button>
      </div>
    </dialog>

  </div>

  <script src="app.js"></script>
  <script async src="https://scripts.simpleanalyticscdn.com/latest.js"></script>
</body>
</html>
